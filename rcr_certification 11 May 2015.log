----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Brian\Dropbox\Research\RCR\Stata program\rcr_certification 11 May 2015.log
  log type:  text
 opened on:  11 May 2015, 19:48:03

. /*******************************************************************
> * RCR_CERTIFICATION.DO
> *
> * This is a do-file designed to provide a detailed test of the RCR
> * program, including its optional arguments and postestimation 
> * commands.  
> *
> * Change log:
> *
> *       5/17/2010       Created
> *       5/19/2010       Small changes to comments; added current date to name of logfile.
> *       5/25/2010       Substantial changes to various asserts to account for the changes
> *                 in precision of calculation for version 0.9.07.
> *   6/24/2011   Added code to test DETAILS option and RCRPLOT command, version 0.9.13.
> *   8/9/2011    Added code to test LOWER and UPPER options for CITYPE, version 0.9.14.
> *   5/11/2015   Changes to accommodate updated variable names (e.g., betax instead of theta), version 1.9.
> *
> *
> ********************************************************************/
. clear all

. set mem 400m
(409600k)

. set more off

. cscript "Testing script for RCR and its postestimation commands" adofiles rcr rcr_estat rcr_predict
-------------------BEGIN Testing script for RCR and its postestimation commands

-> which rcr
.\rcr.ado

-> which rcr_estat
.\rcr_estat.ado

-> which rcr_predict
.\rcr_predict.ado

. 
. use rcr_example, clear
(Project STAR data, kindergarten)

. /* Generate some handy values */
. quietly gen zero = 0

. quietly gen one = 1

. quietly gen two = 2

. set seed 53

. forvalues i = 1 / 20 {
  2.         quietly gen x`i' = runiform()
  3. }

. quietly egen ID = seq()

. quietly gen SAT1000 = SAT*1000

. quietly gen SAT0001 = SAT*0.0001

. quietly gen Small_Class1000 = Small_Class*1000

. quietly gen Small_Class0001 = Small_Class*0.0001

. 
. /*******************************************************************
> * Basic regression with default options 
> ********************************************************************/
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. est store basic

. 
. /* Compare against saved results - these were generated by calling "mkassert eclass" */
. assert `"`e(_estimates_name)'"' == `"basic"'

. assert `"`e(cmd)'"'             == `"rcr"'

. assert `"`e(citype)'"'          == `"Conservative"'

. _assert_streq `"`e(ctrlvar)'"' `" White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree"'

. assert `"`e(treatvar)'"'        == `"Small_Class"'

. assert `"`e(depvar)'"'          == `"SAT"'

. assert `"`e(predict)'"'         == `"rcr_predict"'

. assert `"`e(estat_cmd)'"'       == `"rcr_estat"'

. assert `"`e(title)'"'           == `"RCR model"'

. assert `"`e(properties)'"'      == `"b V"'

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112168 ) <  1E-8

. assert         e(cilevel)   == 95

. assert         e(lambdaH)   == 1

. assert         e(lambdaL)   == 0

. assert         e(N)         == 5839

. tempname T_b 

. mat `T_b' = J(1,5,0)

. mat `T_b'[1,1] =    12.310599093114

. mat `T_b'[1,2] =  8.169709964978111

. mat `T_b'[1,3] =   28.9354891702633

. mat `T_b'[1,4] =   5.13504376498382

. mat `T_b'[1,5] =   5.20150257358542

. tempname C_b

. matrix `C_b' = e(b)

. assert mreldif( `C_b' , `T_b' ) < 1E-8

. _assert_streq `"`: rowfullnames `C_b''"' `"y1"'

. _assert_streq `"`: colfullnames `C_b''"' `"lambdaInf betaxInf lambda0 betaxL betaxH"'

. mat drop `C_b' `T_b'

. tempname T_V 

. mat `T_V' = J(5,5,0)

. mat `T_V'[1,1] =  4.402731051063719

. mat `T_V'[1,2] =  1.680910570472625

. mat `T_V'[1,3] =  14.86034005429277

. mat `T_V'[1,4] =  .0262163576425921

. mat `T_V'[1,5] =  .0148105705706819

. mat `T_V'[2,1] =  1.680910570472625

. mat `T_V'[2,2] =  936.8160737460918

. mat `T_V'[2,3] = -3305.544936154673

. mat `T_V'[2,4] = -20.86047836198298

. mat `T_V'[2,5] =  .0945995722412722

. mat `T_V'[3,1] =  14.86034005429277

. mat `T_V'[3,2] = -3305.544936154673

. mat `T_V'[3,3] =  11776.47628212536

. mat `T_V'[3,4] =  76.32135272938001

. mat `T_V'[3,5] =  2.093295479416368

. mat `T_V'[4,1] =  .0262163576425921

. mat `T_V'[4,2] = -20.86047836198298

. mat `T_V'[4,3] =  76.32135272938001

. mat `T_V'[4,4] =  .9157293949360822

. mat `T_V'[4,5] =  .4385652205906294

. mat `T_V'[5,1] =  .0148105705706819

. mat `T_V'[5,2] =  .0945995722412722

. mat `T_V'[5,3] =  2.093295479416368

. mat `T_V'[5,4] =  .4385652205906294

. mat `T_V'[5,5] =  .4309027113843122

. tempname C_V

. matrix `C_V' = e(V)

. assert mreldif( `C_V' , `T_V' ) < 1E-8

. _assert_streq `"`: rowfullnames `C_V''"' `"lambdaInf betaxInf lambda0 betaxL betaxH"'

. _assert_streq `"`: colfullnames `C_V''"' `"lambdaInf betaxInf lambda0 betaxL betaxH"'

. mat drop `C_V' `T_V'

. /* End comparison */
. 
. /*******************************************************************
> * Basic regression with rescaling
> ********************************************************************/
. est replay basic

----------------------------------------------------------------------------------------------------------------------------------
Model basic
----------------------------------------------------------------------------------------------------------------------------------

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. /* Rescaling both, should leave results roughly unchanged */
. rcr SAT1000 Small_Class1000 White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
     SAT1000 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569396     5.37   0.000     3.259477    7.010611
      betaxH |   5.201503   .6564359     7.92   0.000     3.914912    6.488093
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259477    6.488093
------------------------------------------------------------------------------
Treatment Variable:   Small_Class1000
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488093355120499 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259476500967557 ) <  1E-8

. rcr SAT0001 Small_Class0001 White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree 

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
     SAT0001 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098258     5.87   0.000     8.198089    16.42311
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5194     0.27   0.790    -183.7587    241.6297
      betaxL |   5.135044   .9569373     5.37   0.000     3.259481    7.010606
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class0001
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085194193078 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259481216660567 ) <  1E-8

. /* Scaling outcome up or treatment down, either should multiply coefficient by 1000 */
. rcr SAT1000 Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
     SAT1000 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8169.71   30607.45     0.27   0.790    -51819.79    68159.21
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5135.044   956.9372     5.37   0.000     3259.481    7010.606
      betaxH |   5201.503   656.4318     7.92   0.000      3914.92    6488.085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3259.481    6488.085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6488.085284518956 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3259.481232785231 ) <  1E-8

. rcr SAT Small_Class0001 White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree
 Warning: Inaccurate SE for thetastar. Try normalizing variables to mean zero.


RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098258     5.87   0.000     8.198089    16.42311
    betaxInf |    81697.1   306067.9     0.27   0.790      -518185    681579.2
     lambda0 |   28.93549   108.5193     0.27   0.790    -183.7585    241.6295
      betaxL |   51350.44    9563.04     5.37   0.000     32607.22    70093.65
      betaxH |   52015.03   6559.716     7.93   0.000     39158.22    64871.83
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      32607.22    64871.83
------------------------------------------------------------------------------
Treatment Variable:   Small_Class0001
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 64871.83283612684 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 32607.22424757308 ) <  1E-8

. /* Scaling outcome down or treatment up, either should multiply coefficient by 0.0001 */
. rcr SAT0001 Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
     SAT0001 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    .000817   .0030608     0.27   0.790     -.005182    .0068159
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7587    241.6297
      betaxL |   .0005135   .0000957     5.37   0.000     .0003259    .0007011
      betaxH |   .0005202   .0000656     7.92   0.000     .0003915    .0006488
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      .0003259    .0006488
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , .0006488085303737 ) <  1E-8

. assert reldif( e(betaxCI_L)  , .000325948074516  ) <  1E-8

. rcr SAT Small_Class1000 White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |   .0081697   .0306075     0.27   0.790    -.0518198    .0681592
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |    .005135   .0009569     5.37   0.000     .0032595    .0070106
      betaxH |   .0052015   .0006564     7.92   0.000     .0039149    .0064881
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      .0032595    .0064881
------------------------------------------------------------------------------
Treatment Variable:   Small_Class1000
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , .0064880852473763 ) <  1E-8

. assert reldif( e(betaxCI_L)  , .0032594807011477 ) <  1E-8

. 
. /*******************************************************************
> * Basic regression with different explanatory variables 
> ********************************************************************/
. /***** Things that should produce an error message *****/
. /* No treatment or control variable.  Should (and does) produce an error message. */
. rcof "noisily rcr SAT" == 102
too few variables specified

. /* No control variable.  Should (and does) produce an error message. */
. rcof "noisily rcr SAT Small_Class" == 102
too few variables specified

. /* Outcome variable doesn't vary */
. rcof "noisily rcr zero Small_Class White_Asian" == 1
Error: Dependent variable is constant.

. /* Treatment variable doesn't vary */
. rcof "noisily rcr SAT zero White_Asian" == 1
Error: Treatment variable is constant.

. /* Control variable doesn't vary */
. rcof "noisily rcr SAT Small_Class zero" == 1
Error: At least one control variable is constant.

. /* Collinearity among control variables  */
. rcof "noisily rcr SAT Small_Class White_Asian zero" == 1
Error: At least one control variable is constant.

. rcof "noisily rcr SAT Small_Class White_Asian White_Asian" == 1
Error: Control variables are perfectly collinear.

. /* More than 25 control variables */
. rcof "noisily rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree x1-x20" == 103
too many variables specified

. 
. /***** Things that should produce a warning message but give it a try *****/
. /* Outcome and treatment are identical (collinear) */
. rcof "noisily rcr SAT SAT White_Asian" == 0
Warning: At least one variable is perfectly collinear with other variables.
RCR will continue but results should be viewed with caution.
 Warning: Unable to find a good bracket for thetastar

 Warning: Inaccurate SE for thetaL/H. Try normalizing variables to mean zero.

 Warning: Inaccurate SE for thetaL/H. Try normalizing variables to mean zero.

Warning:  variance matrix is nonsymmetric or highly singular

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |   7.679178          .        .       .            .           .
    betaxInf |          1          .        .       .            .           .
     lambda0 |   7.679178          .        .       .            .           .
      betaxL |   9.0e+306          .        .       .            .           .
      betaxH |  -9.0e+306          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   SAT
Control Variables :   White_Asian

. /* Treatment and control are identical (collinear) */
. rcof "noisily rcr SAT Small_Class Small_Class" == 0
Warning: At least one variable is perfectly collinear with other variables.
RCR will continue but results should be viewed with caution.
 Warning: Inaccurate SE for lambdastar. Try normalizing variables to mean zero.

Warning:  variance matrix is nonsymmetric or highly singular

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |  (omitted)
    betaxInf |    5.22096          .        .       .            .           .
     lambda0 |   2.11e-17          .        .       .            .           .
      betaxL |  -9.0e+306          .        .       .            .           .
      betaxH |   9.0e+306          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   Small_Class

. /* Outcome and control are identical (collinear) */
. rcof "noisily rcr SAT Small_Class SAT" == 0
Warning: At least one variable is perfectly collinear with other variables.
RCR will continue but results should be viewed with caution.
 Warning: Inaccurate SE for lambda0. Try normalizing variables to mean zero.

 Warning: Inaccurate SE for thetaL/H. Try normalizing variables to mean zero.

 Warning: Inaccurate SE for thetaL/H. Try normalizing variables to mean zero.


RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |   9.782348   1.289034     7.59   0.000     7.255887    12.30881
    betaxInf |   504.8372    65.9672     7.65   0.000     375.5439    634.1306
     lambda0 |   1.28e-07   1.03e+09     0.00   1.000    -2.01e+09    2.01e+09
      betaxL |  -1.54e-07   156.5991    -0.00   1.000    -306.9286    306.9286
      betaxH |   1.96e-14   156.5995     0.00   1.000    -306.9295    306.9295
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -306.9286    306.9295
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   SAT

. /* Outcome and control are exactly unrelated */
. /* This leads to an error in RCR.EXE.  It would be nice to catch it in the ado-file */
. preserve

. keep SAT Small_Class

. tempfile tmp

. quietly gen unrelated_variable = 1

. quietly save `tmp', replace

. quietly replace unrelated_variable = 0

. quietly append using `tmp'

. rcof "noisily rcr SAT Small_Class unrelated_variable" == 1
Error in external program RCR.EXE.  Error message is:

 Error - model not identified: var(yhat)=0

Complete log file is : 


 Log file C:\Users\Brian\AppData\Local\Temp\ST_0000001m.tmp for RCR version 1.0
 Run at 19:48 on 05/11/2015
 Reading data from input file C:\Users\Brian\AppData\Local\Temp\ST_0000001k.tmp.
 Line 1: n_moments =            9, n_lambda =            1, external_big_number 
 =   8.988465670000000E+306.
 Line 2: moment_vector =   0.500000000000000        51.4496219797140     
  0.302449049494780       0.500000000000000        25.7248109898570     
  0.151224524747390        3189.60191476330        16.6355689242320     
  0.297314911651260     
  Line            3: lambda_range =   0.000000000000000E+000   1.00000000000000
  For calculations, lambda_range, row           1 is set to   0.000000000000000E
 +000   1.00000000000000
 Data successfully loaded from file C:\Users\Brian\AppData\Local\Temp\ST_0000001
 k.tmp.
 Estimating model.
 Error - model not identified: var(yhat)=0

. restore

. 
. /***** Things that should work *****/
. /* Just one control variable */
. rcr SAT Small_Class White_Asian

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |   120.1447   187.2683     0.64   0.521    -246.8945     487.184
    betaxInf |   796.5343   1234.849     0.65   0.519    -1623.726    3216.794
     lambda0 |   12.19148   19.07011     0.64   0.523    -25.18525    49.56821
      betaxL |   4.744563   .9446153     5.02   0.000     2.893151    6.595974
      betaxH |    5.16614   .6778774     7.62   0.000     3.837524    6.494755
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      2.893151    6.494755
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian

. assert reldif( e(betaxCI_H)  , 6.494755100453821 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 2.893150619179314 ) <  1E-8

. /* Up to 25 control variables */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree x1-x19

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |   9.426544   1.212592     7.77   0.000     7.049909    11.80318
    betaxInf |   1.271935   18.60404     0.07   0.945    -35.19131    37.73518
     lambda0 |   112.3512   1643.797     0.07   0.946    -3109.431    3334.134
      betaxL |   5.265401   .6577305     8.01   0.000     3.976273    6.554529
      betaxH |   5.417208   .9818153     5.52   0.000     3.492886    7.341531
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.976273    7.341531
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree x1 x2 x3 x4 x5 x6 x7
                      x8 x9 x10 x11 x12 x13 x14 x15 x16 x17 x18 x19

. assert reldif( e(betaxCI_H)  , 7.341531127530879 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.976272660323884 ) <  1E-8

. 
. /*******************************************************************
> * IF/IN/WEIGHT options
> ********************************************************************/
. /* IF */
. /* This specification should work */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree if  Free_Lunch > 0

RCR model                                             Number of obs =     5300
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |   12.73046   2.379965     5.35   0.000     8.065813    17.39511
    betaxInf |  -34.69419   34.38336    -1.01   0.313    -102.0843    32.69597
     lambda0 |  -7.555245   7.451559    -1.01   0.311    -22.16003    7.049542
      betaxL |    5.48024   .6906882     7.93   0.000     4.126516    6.833964
      betaxH |   6.326907   .9987373     6.33   0.000     4.369418    8.284396
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      4.126516    8.284396
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 8.284396403084376 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 4.126516220297534 ) <  1E-8

. /* This specification excludes all observations and (properly) produces an error message */
. rcof "noisily rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree if  Free_Lunch>2" 
> == 2000
no observations

. 
. /* IN */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree in 1/100  

RCR model                                             Number of obs =      100
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |   5.819632   3.721572     1.56   0.118    -1.474515    13.11378
    betaxInf |   2.099671   46.50377     0.05   0.964    -89.04605    93.24539
     lambda0 |    48.2152   1083.504     0.04   0.965    -2075.413    2171.844
      betaxL |   10.68703   4.983096     2.14   0.032     .9203358    20.45371
      betaxH |   11.67374   7.953154     1.47   0.142    -3.914158    27.26163
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      .9203358    27.26163
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 27.26163444874422 ) <  1E-8

. assert reldif( e(betaxCI_L)  , .9203357905110554 ) <  1E-8

. /* These two specifications exclude too many observations.  They should produce an error message.*/
. rcof "noisily rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree in 1/1" == 2001
insufficient observations

. rcof "noisily rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree in 1/3" == 2001
insufficient observations

. 
. /* WEIGHT */
. /* Unweighted, for comparison */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. savedresults save unweighted e()

. /* FW=frequency weights, should lead to double the number of observations and smaller SE's */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree [fw = two]

RCR model                                             Number of obs =    11678
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   1.483636     8.30   0.000     9.402725    15.21847
    betaxInf |    8.16971   21.64181     0.38   0.706    -34.24746    50.58688
     lambda0 |   28.93549   76.73157     0.38   0.706    -121.4556    179.3266
      betaxL |   5.135044    .676628     7.59   0.000     3.808877     6.46121
      betaxH |   5.201503   .4641475    11.21   0.000      4.29179    6.111215
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.808877    6.111215
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.111214963474101 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.808877201524171 ) <  1E-8

. /* PW=probability weights, should lead to same number of observations and same SE's */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree [pw = two]

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868134 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112181 ) <  1E-8

. /* AW=analytic weights, should lead to same number of observations and same SE's */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree [aw = two]

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868134 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112181 ) <  1E-8

. /* IW=importance weights, should lead to double the number of observations and smaller SE's */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree [iw = two]

RCR model                                             Number of obs =    11678
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   1.483636     8.30   0.000     9.402725    15.21847
    betaxInf |    8.16971   21.64181     0.38   0.706    -34.24746    50.58688
     lambda0 |   28.93549   76.73157     0.38   0.706    -121.4556    179.3266
      betaxL |   5.135044    .676628     7.59   0.000     3.808877     6.46121
      betaxH |   5.201503   .4641475    11.21   0.000      4.29179    6.111215
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.808877    6.111215
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.111214963474101 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.808877201524171 ) <  1E-8

. /* With weights, but all weights set to one.  This should generate the same results as unweighted */
. quietly rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree [fw = one]

. savedresults compare unweighted e()

. quietly rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree [aw = one]

. savedresults compare unweighted e()

. savedresults drop unweighted

. 
. /*******************************************************************
> * CLUSTER option
> ********************************************************************/
. /* No clustering, for comparison */
. est replay basic

----------------------------------------------------------------------------------------------------------------------------------
Model basic
----------------------------------------------------------------------------------------------------------------------------------

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. /* Clustering on group */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, cluster(TCHID)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


                                (Std. Err. adjusted for 323 clusters in TCHID)
------------------------------------------------------------------------------
             |               Robust
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   8.316739     1.48   0.139     -3.98991    28.61111
    betaxInf |    8.16971   43.64582     0.19   0.852    -77.37452    93.71394
     lambda0 |   28.93549   145.1773     0.20   0.842    -255.6069    313.4778
      betaxL |   5.135044   1.358694     3.78   0.000     2.472053    7.798034
      betaxH |   5.201503   1.030597     5.05   0.000      3.18157    7.221435
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      2.472053    7.221435
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 7.221434897597197 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 2.472053399759639 ) <  1E-8

. /* Clustering on individual ID. Should give the same result as no clustering */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, cluster(ID)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


                                  (Std. Err. adjusted for 5839 clusters in ID)
------------------------------------------------------------------------------
             |               Robust
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112168 ) <  1E-8

. /* Clustering on a constant. Should give missing standard errors and (-inf,+inf) as the CI */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, cluster(zero)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


                                   (Std. Err. adjusted for 1 clusters in zero)
------------------------------------------------------------------------------
             |               Robust
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106          .        .       .            .           .
    betaxInf |    8.16971          .        .       .            .           .
     lambda0 |   28.93549          .        .       .            .           .
      betaxL |   5.135044          .        .       .            .           .
      betaxH |   5.201503          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert         e(betaxCI_L) < -8.99e+305

. assert         e(betaxCI_H) > -8.99e+305

. 
. /*******************************************************************
> * VCEADJ option
> ********************************************************************/
. /* No adjustment, for comparison */
. est replay basic

----------------------------------------------------------------------------------------------------------------------------------
Model basic
----------------------------------------------------------------------------------------------------------------------------------

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. /* Quadruple the covariance matrix (should double the standard errors) */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, vceadj(4.0)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   4.196537     2.93   0.003     4.085537    20.53566
    betaxInf |    8.16971    61.2149     0.13   0.894    -111.8093    128.1487
     lambda0 |   28.93549   217.0389     0.13   0.894     -396.453     454.324
      betaxL |   5.135044   1.913875     2.68   0.007     1.383918     8.88617
      betaxH |   5.201503   1.312864     3.96   0.000     2.628337    7.774668
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      1.383918    7.774668
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 7.774667956150855 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 1.383917661240516 ) <  1E-8

. /* Zero.  Should make the standard errors zero. */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, vceadj(0.0)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106          .        .       .            .           .
    betaxInf |    8.16971          .        .       .            .           .
     lambda0 |   28.93549          .        .       .            .           .
      betaxL |   5.135044          .        .       .            .           .
      betaxH |   5.201503          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. tempname T_V 

. mat `T_V' = J(5,5,0)

. tempname C_V

. matrix `C_V' = e(V)

. assert mreldif( `C_V' , `T_V' ) < 1E-8

. /* Negative.  Should produce an error message */
. rcof "noisily rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, vceadj(-6)" == 11
> 1
Negative values for vceadj not allowed
invalid syntax

. 
. /*******************************************************************
> * LAMBDA option
> ********************************************************************/
. /* Default lambda, for comparison */
. est replay basic

----------------------------------------------------------------------------------------------------------------------------------
Model basic
----------------------------------------------------------------------------------------------------------------------------------

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. /* Specified at default (should be identical) */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(0 1)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112168 ) <  1E-8

. /* A single point (should give the same value for betaxH and betaxL */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(0 0)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        0


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)       3.91492    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.914919882302702 ) <  1E-8

. /* Going from -infinity */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(. 0)
 Warning: Inaccurate SE for thetaL/H. Try normalizing variables to mean zero.


RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        .
                                             Upper bound on lambda  =        0


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
      betaxH |    8.16971    2.10862     3.87   0.000     4.036891    12.30253
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)       3.91492    12.30253
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 12.30252920699166 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.914919882302702 ) <  1E-8

. /* Going to +infinity */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(0 .)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        .


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |  -9.0e+306          .        .       .            .           .
      betaxH |   9.0e+306          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert         e(betaxCI_H) > 8.99e+305

. assert         e(betaxCI_L) < -8.99e+305

. /* Going from -infinity to +infinity */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(. .)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        .
                                             Upper bound on lambda  =        .


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |  -9.0e+306          .        .       .            .           .
      betaxH |   9.0e+306          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert         e(betaxCI_H) > 8.99e+305

. assert         e(betaxCI_L) < -8.99e+305

. /* Just below lambdaInf */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(0 12.3)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =     12.3


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   4.106981   11.32116     0.36   0.717    -18.08209    26.29605
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -18.08209    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , -18.08208794130959) <  1E-8

. /* Just above lambdaInf */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(12 12.32)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =       12
                                             Upper bound on lambda  =    12.32


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |  -9.0e+306          .        .       .            .           .
      betaxH |   9.0e+306          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert         e(betaxCI_H) > 8.99e+305

. assert         e(betaxCI_L) < -8.99e+305

. 
. /*******************************************************************
> * LEVEL option
> ********************************************************************/
. /* Default level (i.e. 95) */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112168 ) <  1E-8

. /* Specify same level as default (should get same result) */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, level(95)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112168 ) <  1E-8

. /* Now replay with a different level */
. /* Doing this will leave the current results in e() unchanged, but report new levels and put them in r() */
. rcr, level(90)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.859254    15.76194
    betaxInf |    8.16971   30.60745     0.27   0.790    -42.17507    58.51449
     lambda0 |   28.93549   108.5195     0.27   0.790    -149.5632    207.4341
      betaxL |   5.135044   .9569375     5.37   0.000     3.561022    6.709066
      betaxH |   5.201503   .6564318     7.92   0.000     4.121768    6.281237
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.561022    6.281237
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112168 ) <  1E-8

. assert reldif( r(betaxCI_H)  , 6.281236804837625 ) <  1E-8

. assert reldif( r(betaxCI_L)  , 3.561021633566327 ) <  1E-8

. /* Estimate with that level. Should get same result, but now stored in e(). */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, level(90)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.859254    15.76194
    betaxInf |    8.16971   30.60745     0.27   0.790    -42.17507    58.51449
     lambda0 |   28.93549   108.5195     0.27   0.790    -149.5632    207.4341
      betaxL |   5.135044   .9569375     5.37   0.000     3.561022    6.709066
      betaxH |   5.201503   .6564318     7.92   0.000     4.121768    6.281237
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.561022    6.281237
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.281236804837625 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.561021633566327 ) <  1E-8

. 
. /*******************************************************************
> * CITYPE option
> ********************************************************************/
. est replay basic

----------------------------------------------------------------------------------------------------------------------------------
Model basic
----------------------------------------------------------------------------------------------------------------------------------

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. /* Specify the same citype as default (result should be the same) */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, citype("conservative")

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.488085264868137 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.259480713112168 ) <  1E-8

. /* Specify Imbens-Manski (should be narrower than default) */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, citype("imbens-manski")

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Imbens-Manski confidence interval)      3.29158    6.466066
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( e(betaxCI_H)  , 6.466066180253211 ) <  1E-8

. assert reldif( e(betaxCI_L)  , 3.291579840373562 ) <  1E-8

. /* Specify Lower. */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, citype("lower")

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Lower confidence interval)            -9.0e+306    6.281237
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert reldif( r(betaxCI_H)  , 6.281236804837625 ) <  1E-8

. assert         r(betaxCI_L) < -8.0e+306

. /* Specify Upper. */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, citype("upper")

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Upper confidence interval)             3.561022    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert         r(betaxCI_H) > 8.0e+306

. assert reldif( r(betaxCI_L)  , 3.561021633566327 ) <  1E-8

. /* Specify NONSENSE (or any other unsupported type).  Should generate a warning message and a missing CI */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, citype("NONSENSE")
WARNING: Unsupported citype NONSENSE

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Nonsense confidence interval)                 .           .
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. assert         e(betaxCI_L) == .

. assert         e(betaxCI_H) == .

. 
. /*******************************************************************
> * SAVE option (undocumented)
> ********************************************************************/
. /* This option tells stata to create files called in.txt, out.txt, and log.txt */
. /* First delete those files if they already exist */
. capture erase in.txt

. capture erase out.txt

. capture erase log.txt

. /* Second, run the command with the option included */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, save
Files to be saved

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. /* Finally, check for existence of the files */
. confirm file in.txt

. confirm file out.txt

. confirm file log.txt

. 
. /*******************************************************************
> * NLCOM , TESTNL postestimation commands
> ********************************************************************/
. est restore basic
(results basic are active now)

. /* Testing TESTNL */
. testnl _b[betaxH] = 0

  (1)  _b[betaxH] = 0

               chi2(1) =       62.79
           Prob > chi2 =        0.0000

. assert reldif( r(chi2)  , 62.78825430596226 ) <  1E-8

. /* Testing NLCOM */
. nlcom _b[betaxH]-_b[betaxL]

       _nl_1:  _b[betaxH]-_b[betaxL]

------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _nl_1 |   .0664588   .6852019     0.10   0.923    -1.276512     1.40943
------------------------------------------------------------------------------

. tempname b b1 v v1

. matrix `b' = r(b)

. scalar `b1' = `b'[1,1]

. assert reldif( `b1' , .0664588086015998) < 1E-8

. matrix `v' = r(V)

. scalar `v1' = `v'[1,1]

. assert reldif( `v1' , .4695016651521872) < 1E-8

. mat drop `b' `v'

. scalar drop `b1' `v1'

. /* What happens if the parameters are not identified? */
. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, lambda(. .)

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        .
                                             Upper bound on lambda  =        .


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |  -9.0e+306          .        .       .            .           .
      betaxH |   9.0e+306          .        .       .            .           .
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)     -9.0e+306    9.0e+306
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. testnl _b[betaxH] = 0

  (1)  _b[betaxH] = 0
       Constraint (1) dropped

               chi2(0) =        0.00
           Prob > chi2 =             .

. assert         r(p)    == .

. assert         r(chi2) == 0

. assert         r(df)   == 0

. nlcom _b[betaxH]-_b[betaxL]

       _nl_1:  _b[betaxH]-_b[betaxL]

------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _nl_1 |   1.8e+307          .        .       .            .           .
------------------------------------------------------------------------------

. tempname T_b 

. mat `T_b'=   1.7976931340e+307

. tempname C_b

. matrix `C_b' = r(b)

. assert mreldif( `C_b' , `T_b' ) < 1E-8

. mat drop `C_b' `T_b'

. 
. /*******************************************************************
> * ESTAT postestimation commands
> ********************************************************************/
. est restore basic
(results basic are active now)

. estat vce

Covariance matrix of coefficients of rcr model

        e(V) |  lambdaInf    betaxInf     lambda0      betaxL      betaxH 
-------------+------------------------------------------------------------
   lambdaInf |  4.4027311                                                 
    betaxInf |  1.6809106   936.81607                                     
     lambda0 |   14.86034  -3305.5449   11776.476                         
      betaxL |  .02621636  -20.860478   76.321353   .91572939             
      betaxH |  .01481057   .09459957   2.0932955   .43856522   .43090271 

. 
. tempname T_V 

. mat `T_V' = J(5,5,0)

. mat `T_V'[1,1] =  4.402731051063719

. mat `T_V'[1,2] =  1.680910570472625

. mat `T_V'[1,3] =  14.86034005429277

. mat `T_V'[1,4] =  .0262163576425921

. mat `T_V'[1,5] =  .0148105705706819

. mat `T_V'[2,1] =  1.680910570472625

. mat `T_V'[2,2] =  936.8160737460918

. mat `T_V'[2,3] = -3305.544936154673

. mat `T_V'[2,4] = -20.86047836198298

. mat `T_V'[2,5] =  .0945995722412722

. mat `T_V'[3,1] =  14.86034005429277

. mat `T_V'[3,2] = -3305.544936154673

. mat `T_V'[3,3] =  11776.47628212536

. mat `T_V'[3,4] =  76.32135272938001

. mat `T_V'[3,5] =  2.093295479416368

. mat `T_V'[4,1] =  .0262163576425921

. mat `T_V'[4,2] = -20.86047836198298

. mat `T_V'[4,3] =  76.32135272938001

. mat `T_V'[4,4] =  .9157293949360822

. mat `T_V'[4,5] =  .4385652205906294

. mat `T_V'[5,1] =  .0148105705706819

. mat `T_V'[5,2] =  .0945995722412722

. mat `T_V'[5,3] =  2.093295479416368

. mat `T_V'[5,4] =  .4385652205906294

. mat `T_V'[5,5] =  .4309027113843122

. tempname C_V

. matrix `C_V' = r(V)

. assert mreldif( `C_V' , `T_V' ) < 1E-8

. _assert_streq `"`: rowfullnames `C_V''"' `"lambdaInf betaxInf lambda0 betaxL betaxH"'

. _assert_streq `"`: colfullnames `C_V''"' `"lambdaInf betaxInf lambda0 betaxL betaxH"'

. mat drop `C_V' `T_V'

. 
. estat summarize

  Estimation sample rcr                  Number of obs =   5839

  -------------------------------------------------------------
      Variable |        Mean     Std. Dev.       Min        Max
  -------------+-----------------------------------------------
           SAT |    51.44962     23.29445   -15.7624    127.289
   Small_Class |     .302449     .4537342   -.132334    1.13789
   White_Asian |    .6723754     .2394896   -.317625     1.6565
          Girl |    .4874122     .4965591   -.186057    1.18741
    Free_Lunch |    .4836445      .416402   -.497308    1.46849
  White_Teac~r |    .8405549     .2504451   -.034445    1.66278
  Teacher_Ex~e |    9.266998     5.152943   -2.39967    25.0565
  Masters_De~e |    .3519438     .3908864   -.498056     1.2427
  -------------------------------------------------------------

. tempname T_stats 

. mat `T_stats' = J(8,4,0)

. mat `T_stats'[1,1] =  51.44962197971362

. mat `T_stats'[1,2] =  23.29444665859316

. mat `T_stats'[1,3] = -15.76239002946902

. mat `T_stats'[1,4] =    127.28907462949

. mat `T_stats'[2,1] =  .3024490494947765

. mat `T_stats'[2,2] =  .4537342203017396

. mat `T_stats'[2,3] = -.1323335592008756

. mat `T_stats'[2,4] =   1.13789208746946

. mat `T_stats'[3,1] =  .6723754067477308

. mat `T_stats'[3,2] =  .2394896046268605

. mat `T_stats'[3,3] = -.3176245932522692

. mat `T_stats'[3,4] =  1.656502390874715

. mat `T_stats'[4,1] =  .4874122281212536

. mat `T_stats'[4,2] =  .4965590599853063

. mat `T_stats'[4,3] = -.1860571596338484

. mat `T_stats'[4,4] =  1.187412228121254

. mat `T_stats'[5,1] =  .4836444596677513

. mat `T_stats'[5,2] =  .4164020368805063

. mat `T_stats'[5,3] = -.4973079212846296

. mat `T_stats'[5,4] =  1.468492944516236

. mat `T_stats'[6,1] =  .8405548895358794

. mat `T_stats'[6,2] =  .2504450623319503

. mat `T_stats'[6,3] = -.0344451104641206

. mat `T_stats'[6,4] =  1.662777111758102

. mat `T_stats'[7,1] =  9.266997773591369

. mat `T_stats'[7,2] =  5.152943131556667

. mat `T_stats'[7,3] = -2.399668893075297

. mat `T_stats'[7,4] =  25.05647145780189

. mat `T_stats'[8,1] =  .3519438259976023

. mat `T_stats'[8,2] =  .3908864114709845

. mat `T_stats'[8,3] = -.4980561740023977

. mat `T_stats'[8,4] =  1.242700128518611

. tempname C_stats

. matrix `C_stats' = r(stats)

. assert mreldif( `C_stats' , `T_stats' ) < 1E-8

. _assert_streq `"`: rowfullnames `C_stats''"' `"SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Mast
> ers_Degree"'

. _assert_streq `"`: colfullnames `C_stats''"' `"mean sd min max"'

. mat drop `C_stats' `T_stats'

. /* This should produce an error message */
. rcof "noisily estat ic" == 321
IC option not supported with RCR model

. 
. /*******************************************************************
> * ESTIMATES postestimation commands
> ********************************************************************/
. estimates stats basic

-----------------------------------------------------------------------------
       Model |    Obs    ll(null)   ll(model)     df          AIC         BIC
-------------+---------------------------------------------------------------
       basic |   5839           .           .      4            .           .
-----------------------------------------------------------------------------
               Note:  N=Obs used in calculating BIC; see [R] BIC note

. estimates table basic, b(%9.3f) se p title("Results from RCR") stats(N)

Results from RCR

--------------------------
    Variable |   basic    
-------------+------------
   lambdaInf |    12.311  
             |     2.098  
             |    0.0000  
    betaxInf |     8.170  
             |    30.607  
             |    0.7895  
     lambda0 |    28.935  
             |   108.519  
             |    0.7897  
      betaxL |     5.135  
             |     0.957  
             |    0.0000  
      betaxH |     5.202  
             |     0.656  
             |    0.0000  
-------------+------------
           N |      5839  
--------------------------
            legend: b/se/p

. 
. /*******************************************************************
> * PREDICT postestimation command
> ********************************************************************/
. /* The predict command is not supported, so this should produce an error message */
. rcof "noisily predict" == 321
PREDICT not supported for RCR model
requested action not valid after most recent estimation command

. 
. *******************************************************************
. * DETAILS option and RCRPLOT postestimation command
. ********************************************************************/
. /* Call RCRPLOT without having specified DETAILS.  Should generate an error message */
. estimates restore basic
(results basic are active now)

. rcof "noisily rcrplot" == 321  
Information needed for rcrplot unavailable; use details option when calling rcr
requested action not valid after most recent estimation command

. 
. /* Call RCR with DETAILS specified */
. preserve

. set scheme s2mono /* The default scheme (s2color) changes slightly after version 8, so we use a scheme that didn't change */

. rcr SAT Small_Class White_Asian Girl Free_Lunch White_Teacher Teacher_Experience Masters_Degree, details

RCR model                                             Number of obs =     5839
                                             Lower bound on lambda  =        0
                                             Upper bound on lambda  =        1


------------------------------------------------------------------------------
         SAT |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   lambdaInf |    12.3106   2.098269     5.87   0.000     8.198068    16.42313
    betaxInf |    8.16971   30.60745     0.27   0.790    -51.81979    68.15921
     lambda0 |   28.93549   108.5195     0.27   0.790    -183.7588    241.6298
      betaxL |   5.135044   .9569375     5.37   0.000     3.259481    7.010607
      betaxH |   5.201503   .6564318     7.92   0.000      3.91492    6.488085
-------------+----------------------------------------------------------------
       betax |    (Conservative confidence interval)      3.259481    6.488085
------------------------------------------------------------------------------
Treatment Variable:   Small_Class
Control Variables :   White_Asian Girl Free_Lunch White_Teacher
                      Teacher_Experience Masters_Degree

. quietly summarize lambda

. assert reldif( r(mean)   , 39.17132731582898 ) <  1E-8

. 
. /* Save plot (as a postscript file) and check to make sure it hasn't changed */
. tempfile rcrplot

. quietly graph export `rcrplot', as(ps) replace

. checksum `rcrplot'
Checksum for C:\Users\Brian\AppData\Local\Temp\ST_0000006w.tmp = 3556610235, size = 800760

. assert r(checksum) == 3556610235

. 
. /* Call RCRPLOT with arguments */
. rcrplot, xrange(-20 20) yrange(-40 40)

. quietly graph export `rcrplot', as(ps) replace

. checksum `rcrplot'
Checksum for C:\Users\Brian\AppData\Local\Temp\ST_0000006w.tmp = 1962833918, size = 282500

. assert r(checksum) == 1962833918

. 
. restore

. 
. *******************************************************************
. * TEST_THETA postestimation command
. ********************************************************************/
. /* Call RCRPLOT without having specified DETAILS.  Should generate an error message */
. estimates restore basic
(results basic are active now)

. test_betax

 ( 1)     betax = 0

         P-value = 0.0000

. assert reldif( r(p)  , 6.75341735534e-08 ) <  1E-8

. test_betax =  3.29158

 ( 1)     betax = 3.29158

         P-value = 0.0500

. assert reldif( r(p)  , .0500000163998828 ) <  1E-8

. 
. 
. log close
      name:  <unnamed>
       log:  C:\Users\Brian\Dropbox\Research\RCR\Stata program\rcr_certification 11 May 2015.log
  log type:  text
 closed on:  11 May 2015, 19:49:20
----------------------------------------------------------------------------------------------------------------------------------
